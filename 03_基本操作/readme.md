# シェルとは
シェルはコマンドインタプリタで、標準入力またはファイルから読み込んだコマンド実行すします。

![](https://storage.googleapis.com/zenn-user-upload/212829100fbe-20240717.png)


## シェルの変数
シェルには環境を調整する変数としてシェル変数と環境変数があります。

変数|説明
-|-
シェル変数|設定されたシェルだけが使用できる変数。子プロセスに引き継がれない。
環境変数|設定されたシェルとそのシェルで起動したプログラムが使用する変数。シェル変数をエクスポート宣言することで作成する。

<br>

主なシェル変数
変数名|説明
-|-
PWD|カレントディレクトリの絶対パス
PATH|コマンド検索パス
HOME|ユーザーのホームディレクトリ
PS1|プロンプトを定義
HISTFILE|コマンド履歴を格納するファイルを定義
LANG|言語情報

### 変数の設定、削除

現在のLANG変数を確認
```
echo $LANG
```

<br>

LANG変数を削除
```
unset LANG
```
<br>

LANG変数を設定
```
LANG=ja_JP.UTF-8
```

<br>
実行例
LANG変数を削除した後、dateコマンドの結果が英語となります。


```
# 現在の環境変数LANGが日本語となっていることを確認
[testuser@localhost ~]$ echo $LANG
ja_JP.UTF-8

# dateコマンドを実行した時、日本語で表示されます。
[testuser@localhost ~]$ date
2024年  7月 26日 金曜日 19:52:29 JST

# LANG変数を削除
[testuser@localhost ~]$ unset LANG

# LANG変数を確認すると何もないことが分かります。
[testuser@localhost ~]$ echo $LANG

# dateコマンドを実行すると英語表記になりました。
[testuser@localhost ~]$ date
Fri Jul 26 19:52:51 JST 2024
```


## 環境変数を設定

```
export LANG=ja_JP.UTF-8
```
<br>
環境変数にLANGが設定されたか確認
```
printenv | grep LANG
```

![](https://storage.googleapis.com/zenn-user-upload/fb9d1c2b1333-20240717.png)

## コマンドの履歴

シェルから実行したコマンドの実行履歴を「history」コマンドで確認することができます。またキーの操作で履歴を呼び出すことができます。

キー操作|説明
-|-
↑（上矢印キー）|1つ前のコマンドを表示する
↓（下矢印キー）|1つ後のコマンドを表示する
!!|直前に実行したコマンドを実行する
!履歴番号|指定した履歴番号のコマンドを実行する
!文字列|指定した文字列から始まる直近のコマンドを実行する

コマンドの履歴はデフォルトではホームディレクトリの.bash_historyファイルに格納されています。

# マニュアル

/usr/share/manディレクトリ配下にマニュアルページが置かれています。


オプション | 説明
-|- 
-a| 指定したすべてのマニュアルページを表示します。
-k| 指定したキーワードに関連するマニュアルページの簡単な説明を検索します（`apropos`と同じ）。
-f| 指定したコマンドやプログラムに関連するマニュアルページを一覧表示します（`whatis`と同じ）。
-l| 指定したファイル名をマニュアルページとして表示します。
-s| 指定したセクション番号のマニュアルページを検索して表示します。
-C| 指定した設定ファイルを使用して`man`を実行します。
--help| `man`コマンドのヘルプメッセージを表示します。
--version| `man`コマンドのバージョン情報を表示します。

<br>

今回はlsのマニュアルを開きます。


```
man ls
```

<br>


以下のような画面が開けたと思います。

![](https://storage.googleapis.com/zenn-user-upload/f810e27425a3-20240718.png)

<br>

マニュアルページでは矢印キーでの操作の他、別のキーで操作することができます。

キー操作|説明
-|-
Enter|次の行を表示
スペース|次のページを表示
b|前のページを表示
h|ヘルプを表示
q|manコマンドの終了
/文字列|指定した文字列でマニュアルページ内を検索


<br>

## トラブルシューティング

以下のようなメッセージが出た場合、manデータベースが適切に設定されていない可能性があります。この場合、manデータベースを更新する必要があります。CentOS 9では、mandbコマンドを使用してデータベースを更新できます。

```
[root@localhost ~]# man -f ls
ls: 適切なものはありませんでした。
```

<br>

まず、mandbコマンドを使用してデータベースを更新します。

```
sudo mandb
```


```
[root@localhost ~]# man -f ls
ls (1)               - list directory contents
ls (1p)              - list directory contents
```


ls (1): 標準のユーザコマンドについてのマニュアルページです。これは通常、Linuxディストリビューションが提供するデフォルトのlsコマンドについて説明しています。


```
man 1 ls
```


ls (1p): POSIX（Portable Operating System Interface）の標準に準拠したコマンドについてのマニュアルページです。POSIXは、Unix互換システム間の互換性を確保するための一連の標準規格です。ls (1p)は、POSIX標準に準拠したlsコマンドの仕様を説明しています。


```
man 1p ls
```

# ユーザーの切り替え

「su」コマンドで現在のユーザーを別のユーザーに切り替えることができます。<br>
rootユーザーに切り替える

```
su -
```
<br>
指定したユーザーに切り替える

```
su - [ユーザー名]
```

<br>
また「su」コマンドを使用する際に、何も指定しない場合はインタラクティブシェルが起動され、「su -」を使用するとログインシェルが起動されるという違いがあります。


**インタラクティブシェル**
インタラクティブシェルとは、ユーザーが直接コマンドを入力し、その結果を即座に見ることができるシェルです。インタラクティブシェルでは、ユーザーとシェルが対話的にやり取りするため、ユーザーが一つずつコマンドを入力し、それに対する出力を見ながら次のコマンドを入力する形になります。

**ログインシェル**
ログインシェルとは、ユーザーがシステムにログインした時に最初に起動されるシェルのことです。ログインシェルは、システム全体の環境設定を読み込むための特別な設定があります。


以下は「su」でrootユーザーに切り替え、インタラクティブシェルが起動されています。こちらではtestuserのホームディレクトリが移動していないことが分かります。

![](https://storage.googleapis.com/zenn-user-upload/8eb2fd3042f1-20240718.png)

## シェルの設定ファイル(bash)

### ログインシェルの設定ファイル

以下のファイルは、ログインシェルの起動時に実行され、ユーザーのシェル環境を設定するために使用されます。

| 順序 | ファイル名               | 説明                                                       |
|------|-------------------------|------------------------------------------------------------|
| 1    | /etc/profile         | システム全体のログインシェルの初期化設定を行う。           |
| 2    | ~/.bash_profile     | ユーザーのホームディレクトリにあるログインシェルの初期化設定。|
| 3    | ~/.bash_login         | `~/.bash_profile` が存在しない場合に実行される。            |
| 4    | ~/.profile            | `~/.bash_profile` と `~/.bash_login` が存在しない場合に実行される。|


### 非ログインシェル、インタラクティブシェル

非ログインシェル、インタラクティブシェルが起動されると「~/.bashrc」が実行されます。

**非ログインシェル**
非ログインシェルは、ユーザーがシステムにログインしていない状態で起動されるシェルです。通常、GUI環境からターミナルを開いたときや、既にログインしているセッションから新しいシェルを開始したときに起動されます。
