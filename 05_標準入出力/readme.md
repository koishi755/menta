# 標準入出力とは
標準入出力 (Standard Input/Output) は、コンピュータシステムにおいて重要な概念です。プログラムやシステムがデータの受け渡しを行うための基本的なメカニズムです。

![](https://storage.googleapis.com/zenn-user-upload/21fb7b14dc70-20240719.png)

## 標準入力 (stdin)
標準入力は、プログラムやコマンドがデータを受け取るための仕組みです。通常、キーボードからの入力やファイルからの読み込みがこの入力源として使われます。

- キーボード入力: ユーザーがコマンドラインでキーボードから直接入力することができます。例えば、対話型のプログラムやシェルでのコマンド入力などが該当します。
- ファイルからの読み込み: ファイルからのデータをプログラムに供給することができます。この場合、リダイレクションを使ってファイルを指定することが一般的です。

## 標準出力 (stdout)
標準出力は、プログラムやコマンドが処理結果やメッセージを出力するための方法です。通常、画面に表示されるテキストやファイルへの書き込みがこの出力先として使われます。

- 画面への表示: プログラムが処理結果やメッセージをターミナル上に表示します。これにより、ユーザーは実行中のプログラムの進行状況や結果を確認できます。
- ファイルへの書き込み: プログラムが処理結果をファイルに書き込むことができます。リダイレクションを使って出力先のファイルを指定することが可能です。

## 標準エラー出力 (stderr) 
標準エラー出力は、プログラムやコマンドがエラーメッセージや警告を出力するためのチャネルです。通常、標準出力とは別の出力先として使われます。

- エラーメッセージの表示: プログラムがエラーや警告を出力する際に使用されます。これにより、ユーザーは問題が発生した際にそれを認識し、対処することができます。

```bash
[testuser@localhost work]$ ls test test1
ls: 'test1' にアクセスできません: そのようなファイルやディレクトリはありません # ←標準エラー出力
test # ←標準出力
```



# 標準入力の基本的な使用方法

## コマンドラインからの入力

ユーザーがターミナルでコマンドを実行する際に、コマンドライン引数の代わりに標準入力からデータを取得することができます。例えば、catコマンドで標準入力からファイルの内容を表示することができます。
以下の例の場合input.txtの内容が標準入力としてcatに渡されます。

```bash
# テスト用のファイルを作成
[testuser@localhost work]$ echo '標準入力のテスト' > test_input
[testuser@localhost work]$

# test_input の内容をcatコマンドに渡す。
[testuser@localhost work]$ cat < test_input
標準入力のテスト
```

## パイプによる他のプログラムからの入力

他のプログラムの出力を標準入力として受け取ることができます。これにより、複数のコマンドを連結してデータを処理することができます。
以下の例の場合input.txtの内容が標準入力としてcatに渡され、その結果をgrepの標準入力として渡されます。

```bash
[testuser@localhost work]$ cat < test_input | grep 'テスト'
標準入力のテスト
```


ここから続き

# 標準出力の基本的な利用方法

## コマンドの出力結果の表示

最も基本的な標準出力の利用方法は、コマンドの実行結果を端末に表示することです。
この例では、echo コマンドが "Hello, World!" を標準出力に書き込み、端末に表示します。

```bash
echo "Hello, World!"
```

```bash:実行結果
[testuser@localhost work]$ echo "Hello, World!"
Hello, World!
```

## ファイルへの出力
リダイレクション (>) を使用すると、標準出力をファイルに書き込むことができます。
このコマンドは、"Hello, World!" を output.txt ファイルに書き込みます。既存のファイルがある場合、その内容は上書きされます。

```bash
echo "Hello, World!" > output.txt
```

```bash:実行結果
[testuser@localhost work]$ echo "Hello, World!" > output.txt
[testuser@localhost work]$ cat output.txt
Hello, World!
```

## ファイルへの追記

リダイレクション (>>) を使用すると、標準出力をファイルに追記することができます。
このコマンドは、output.txt ファイルの末尾に "Hello, again!" を追加します。

```bash
echo "Hello, again!" >> output.txt
```

```bash:実行結果
[testuser@localhost work]$ echo "Hello, again!" >> output.txt
[testuser@localhost work]$ cat output.txt
Hello, World!
Hello, again!
```


## パイプを通じた他のコマンドへの出力

パイプ (|) を使用すると、あるコマンドの標準出力を別のコマンドの標準入力として渡すことができます。この例では、echo コマンドの出力を tr コマンドに渡し、小文字を大文字に変換しています。

```
echo "Hello, World!" | tr '[:lower:]' '[:upper:]'
```

```bash:実行結果
[testuser@localhost work]$ echo "Hello, World!" | tr '[:lower:]' '[:upper:]'
HELLO, WORLD!
```

# 標準エラー出力の基本的な利用方法

標準エラー出力は、プログラムが実行中に発生するエラーや警告をユーザーに伝えるために使用されます。たとえば、ファイルの読み込みエラーやコマンドの不正な引数に関するエラーなどが含まれます。
このコマンドは存在しないディレクトリ /sttderr_dir をリストしようとしますが、エラーメッセージが標準エラー出力に表示されます。

```bash
ls /sttderr_dir
```

```bash:実行結果
[testuser@localhost work]$ ls /sttderr_dir
ls: '/sttderr_dir' にアクセスできません: そのようなファイルやディレクトリはあり ません
```

## 標準エラー出力のリダイレクション

### エラーメッセージをファイルにリダイレクト

このコマンドは、エラーメッセージを error.log ファイルにリダイレクトします。

```
ls /sttderr_dir 2> error.log
```

```bash:実行結果
[testuser@localhost work]$ ls /sttderr_dir 2> error.log
[testuser@localhost work]$ cat error.log
ls: '/sttderr_dir' にアクセスできません: そのようなファイルやディレクトリはあり ません
```


### 標準出力と標準エラー出力を別々のファイルにリダイレクト
このコマンドは、標準出力を output.log に、標準エラー出力を error.log にリダイレクトします。

```bash
command > output.log 2> error.log
```

```bash:実行結果
# test1 を作成
[testuser@localhost work]$ touch test1
[testuser@localhost work]$

# ls で存在するファイルと存在しないファイルを指定する
[testuser@localhost work]$ ls test1 test2 > output.log 2> error.log

# 標準出力されたファイルの中身を確認
[testuser@localhost work]$ cat output.log
test1

# エラー出力されたファイルの中身を確認
[testuser@localhost work]$ cat error.log
ls: 'test2' にアクセスできません: そのようなファイルやディレクトリはありません
```

### 標準出力と標準エラー出力を同じファイルにリダイレクト
このコマンドは、標準出力と標準エラー出力の両方を all.log ファイルにリダイレクトします。

```bash
command > all.log 2>&1
```

```bash:実行結果
# test1 を作成
[testuser@localhost work]$ touch test1

# ls で存在するファイルと存在しないファイルを指定する
[testuser@localhost work]$ ls test1 test2 > all.log 2>&1

# 標準出力と標準エラー出力されたファイルを確認
[testuser@localhost work]$ cat all.log
ls: 'test2' にアクセスできません: そのようなファイルやディレクトリはありません
test1
```

### 標準エラー出力を利用したエラーメッセージの表示方法

標準エラー出力を利用して、プログラムのエラーメッセージを表示することが一般的です。たとえば、シェルスクリプトやプログラム内でエラーメッセージを表示する方法を以下に示します。
このスクリプトは、指定されたファイルが存在しない場合にエラーメッセージを標準エラー出力に表示します。

```bash:シェルスクリプトでの例
#!/bin/bash

if [ ! -f "$1" ]; then
    echo "Error: File not found" >&2
    exit 1
fi
```

### エラーログファイルへの記録

エラーメッセージをログファイルに記録することで、システムの監視やトラブルシューティングが容易になります。このコマンドは、my_program のエラーメッセージを error.log に追記します。

```bash:エラーのみリダイレクト
my_program 2>> error.log
```

```bash:標準出力とエラー出力をリダイレクト
my_program >> output.log 2>&1
```


# ファイルディスクリプタ
ここまでで「2>>」と出てきた「2」はファイルディスクリプタといいます。
ファイルディスクリプタ（File Descriptor）とは、オペレーティングシステムがファイルや入出力ストリームを管理するために使用する抽象的なリソース識別子です。プロセスがファイルや入出力ストリームを操作するために使用する整数値で、主に以下のようなディスクリプタがあります。

ディスクリプタ番号|入出力|説明
-|-|-
0|標準入力|ユーザーからの入力を受け取るためのデフォルトの入力ストリーム
1|標準出力|プログラムの出力を表示するためのデフォルトの出力ストリーム
2|標準エラー出力|エラーメッセージや警告を表示するためのデフォルトのエラーストリーム
3以上|ファイルディスクリプタ|任意のファイルやソケット、パイプなどのリソースに対して割り当てられるディスクリプタです。プロセスがファイルやソケットを開くと、新たなディスクリプタが割り当てられます。

## その他のファイルディスクリプタ

標準の3つのディスクリプタ（stdin, stdout, stderr）以外にも、プロセスが利用するファイルディスクリプタは追加で管理できます。これらは通常、ファイルやネットワークソケット、パイプなど、標準のストリーム以外のリソースを扱う際に使用されます。(上記の３以上)
